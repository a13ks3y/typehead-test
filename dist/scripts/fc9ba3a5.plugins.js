!function(a,b,c){"use strict";var d=function(c,d){if(b.isArray(c))c=c.slice(0),b.isObject(d)||(d={});else{if(!b.isObject(c))throw new Error("A typeahead must be created with either initial models or have its collection specified in an options object");d=c}this.preInitialize.call(this,c,d),a.View.call(this,d),this.postInitialize.call(this)};d.VERSION="0.3.0",d.extend=a.View.extend,d.ItemView=a.View.extend({tagName:"li",className:"typeahead-item",events:{click:"selectItem",mouseover:"activateItem"},initialize:function(a){this.parent=a.parent},render:function(){return this.$el.html(b.template(this.template)(this.model.toJSON())),this},selectItem:function(){this.parent.selectModel(this.model)},activateItem:function(){this.parent.activateModel(this.model)}}),b.extend(d.prototype,a.View.prototype,{preInitialize:function(c,e){e.key=e.key||"name",e.limit=e.limit||8,b.isUndefined(e.collection)&&b.isArray(c)&&(e.collection=new a.Collection(c,e)),this.view=e.view,b.isUndefined(this.view)&&(this.view=d.ItemView.extend({template:e.itemTemplate||"<a><%- "+e.key+" %></a>"})),this.events=b.extend({},this.nativeEvents,b.result(this,"events")),this.options=e},postInitialize:function(){this.results=[],this.focused=!1,this.shown=!1,this.mousedover=!1},template:'<input type="text" class="form-control" placeholder="Search" /><ul class="dropdown-menu"></ul>',nativeEvents:{keyup:"keyup",keypress:"keypress",keydown:"keydown","blur input":"blur","focus input":"focus",mouseenter:"mouseenter",mouseleave:"mouseleave"},render:function(){return this.$el.html(this.template),this.$menu=this.$("ul"),this.$input=this.$("input"),this},rerender:function(a){this.$menu.empty(),b.each(a,this.renderModel,this),a.length?this.show():this.hide()},renderModel:function(a){this.$menu.append(new this.view({model:a,parent:this}).render().el)},search:function(a){var b=a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),c=new RegExp(b,"i"),d=this.options.key;return this.collection.filter(function(a){return c.test(a.get(d))})},clearInput:function(){this.$input.val("")},searchInput:function(){this.results=this.search(this.$input.val()).slice(0,this.options.limit),this.rerender(this.results)},select:function(){var a=this.$menu.find(".active").index();this.selectModel(this.results[a])},selectModel:function(a){this.$input.val(a.get(this.options.key)),this.hide(),this.trigger("selected",a,this.collection),this.results=[]},activateModel:function(){this.$menu.find(".active").removeClass("active")},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.searchInput()}a.stopPropagation(),a.preventDefault()},focus:function(){this.focused=!0,this.shown||this.show()},blur:function(){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},mouseenter:function(){this.mousedover=!0},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()},keydown:function(a){this.suppressKeyPressRepeat=~c.inArray(a.keyCode,[40,38,9,13,27]),this.move(a)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prevItem();break;case 40:a.preventDefault(),this.nextItem()}a.stopPropagation()}},prevItem:function(){var a=this.$menu.find(".active").removeClass("active"),b=a.prev();b.length||(b=this.$menu.find("li").last()),b.addClass("active")},nextItem:function(){var a=this.$menu.find(".active").removeClass("active"),b=a.next();b.length||(b=this.$menu.find("li").first()),b.addClass("active")},show:function(){if(this.results.length){var a=c.extend({},this.$input.position(),{height:this.$input[0].offsetHeight});return this.$menu.css({top:a.top+a.height,left:a.left}).show(),this.shown=!0,this}},hide:function(){return this.$menu.hide(),this.shown=!1,this}}),a.Typeahead=d}(Backbone,_,$);